---
layout: post
title: CRA환경에서 Yarn berry를 사용해보았다.
tag: React, Yarn
---

# Yarn Berry를 왜 사용했는가?

얼마전 2023 '토스' 윈터 인턴채용에서 패키지매니저를 `yarn berry`를 사용한다고 명시해놨다. 거기서부터 궁금증이생겼다. 처음 공부할때는 node에서 제공하는 npm을 사용하였고, 멋사 6기 프론트엔드스쿨에서 야무쌤과 함께하는 React수업에서는 pnpm을 사용하였다. yarn이라는 패키지매니저가 존재한다는 것은 알았지만, yarn berry..? 이참에 yarn을 사용해볼겸 패키지를 yarn berry로 구성해보려 한다.

# yarn을 알기전 npm부터 알고가자!

# **공식 홈페이지 주소**

더 많은 정보와 자세한 내용은 해당 도구의 [공식 홈페이지](https://pnpm.io/)를 확인하면 좋을 것 같다.

- **Yarn은 npm의 단점을 보완하기 위해 Facebook에서 개발된 패키지 매니저입니다.**

🤔 **npm의 단점**은 다음과 같다.

**1. 성능 및 설치 속도(순차적 설치)**

👉 Yarn은 패키지 데이터를 캐시(cache)에 저장하여 중복된 데이터를 다운로드하지 않는다.
👉 Yarn은 병렬적으로 패키지를 설치하여 빠른 설치를 지원한다.

**2. 보안성 취약**

👉 npm은 잠금 파일이 없어 의존성 패키지의 버전 충돌이 발생할 수 있다.
👉 Yarn은 **`yarn.lock`** 파일을 사용하여 모든 디바이스에 동일한 패키지 버전을 설치하여 버전 충돌로 인한 버그를 방지한다.

❗ 현재는 npm도 **`package-lock.json`** 파일을 제공하여 버전 충돌 문제를 완화하고 있다. 그러나 Yarn은 여전히 캐싱과 병렬 설치 등의 기능으로 성능을 높이고 있다.

---

# **yarn Berry**

## yarn (Yet Another Resource Negotiator)

- Facebook에서 발표한 Yarn의 두 번째 버전(2020)
- **`Plug'n'Play(PnP)`** 라고 불리는 새로운 패키지 관리 방식👉 유령 의존성에 관한 문제 해결

### **Plug'n'Play(PnP)**

패키지를 프로젝트의 **`node_modules`** 디렉토리에 저장하지 않는다. 대신, 패키지들에 대한 의존성 정보는 **.zip**파일로 압축되어 **`.yarn/cache`** 폴더에 저장하고, 이를 찾기 위한 정보를 **`.pnp.cjs`** 파일에 기록한다.

👉 **`.pnp.cjs`**를 이용함으로써 별도의 디스크 I/O 작업 없이도 패키지의 위치를 정확히 알 수 있기에 시간을 단축하고, 중복 설치를 방지하며 **`node_modules`**를 만들고 패키지들을 호이스팅시킬 필요가 없다.

### **장점**

1. 무거웠던 **`node_modules`**를 제거하고 옮긴 덕분에, 의존성까지 GitHub에 올릴 수 있게 되었다.
   👉 **zero-install** : **`git clone`** 이후 **별도의 설치 필요 없이 (`yarn install` 명령어 없이)** 바로 사용할 수 있게 되었다.
   👉 브랜치 변경시에도 해당 브랜치에 이미 필요한 의존성 패키지가 존재하므로 **`yarn install`** 없이 프로젝트를 실행할 수 있다.
   👉 **CI**에서 의존성 설치하는 시간을 크게 절약할 수 있습니다! (원래 **`node_modules`**는 너무 무거워서 **`.gitignore`**에 포함되고 우리는 package.json에 기록된걸 각자 로컬에서 다운 받는 방식!)

2. 각 패키지가 zip 아카이브로 압축되어 있으므로, 스토리지 용량을 크게 아낄 수 있다.

   - 예를 들어, npm 이용시 **`node_modules`** 디렉토리가 약 400MB를 차지했지만, Yarn PnP 사용시 의존성 디렉토리 크기는 120MB에 불과하다.

3. 의존성을 구성하는 파일의 수가 많지 않으므로 변경 사항을 감지하거나 전체 의존성을 삭제하는 작업이 빠르다.

---

# CRA에서 사용하면서 문제점.

<img src='./../../assets/img/programming/errorJest.png' alt='jest사용시 에러메시지'>

이와같은 에러메시지가 발생한다.

이 에러를 해결하려고 구글링을 해보니, 이 에러는 Jest버전이 5로 넘어오면서 무언가 빠진거때문에 호환성문제가 생긴듯하다. (정확히 모름)
**그래서 yarn berry에서 기존 jest를 4버전으로 내리니 문제없이 구동되었다.**
