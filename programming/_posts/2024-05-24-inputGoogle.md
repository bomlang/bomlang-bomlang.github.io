---
layout: post
title: 주소창에 ’www.google.com‘을 입력하면 어떤 일이 일어날까?
tag: DNS, CDN, TCP, 브라우저
---

무슨일이 일어나는데...?
어느 화창한 면접날(?)에 면접관이 내게 질문을 던진다.

면접관 : 브라우저 주소창에 google.com을 입력하게 되면 무슨일이 일어나나요?

나 : 구글창이 뜹니다!!
면접관 : 나가.

물론 이렇게 대답하면 안되기 때문에 우리는 지금부터 어떤일이 일어날건지 알아보려한다.

1. 주소창에 적혀있는 주소를 해석한다.
   사용자가 브라우저 주소창에 'google.com’이라고 입력하면, 브라우저는 해당 URL을 분석하여 ‘http://' 또는 'https://‘ 프로토콜을 추가한다.
   일방적으로 'https://' 프로토콜을 추가한다.

1. DNS 해석
   사용자가 주소창에 'www.google.com'을 입력했다고 브라우저에서는 해당 URL로 이동할 수 없다. 그 이유는 IP주소를 모르기 때문이다.
   기억해두자. 모든 웹사이트는 ‘IP주소’로 되어있다!
   그러면 DNS는 URL을 IP주소로 바꿔주는 역할인가?
   뭐... 그렇다고 할 수도 있긴한데 면접관에게 강렬한 인상을 남기기 위해서는 조금 더 디테일하게 알 필요가 있다.

DNS - 캐싱에 대해서 알고가자.
사용자가 네이버에 접속한다고 가정하자.

가장 처음으로 로컬단에서 DNS캐싱이 이루어진다.
하지만 찬물도 위아래가 있는법!
먼저 브라우저단에서 DNS캐싱을 한다. ex) 최근 페
만약 브라우저에 해당 URL에 대한 DNS정보가 없다면 OS단에서 확인이 이루어진다.
Windows는 ‘DNS Client Service’라는 시스템 서비스를 이용해 캐시를 관리한다.

Mac OS는 'Name Service Cache Daemon‘ 또는 'Systemed-resolved‘라는 서비스를 통해 DNS캐싱이 이루어진다.

이렇게 브라우저와 내 OS까지 확인했는데 로컬단에도 사용자가 접속하려는 URL에 대한 IP정보가 없다면 ISP(인터넷 서비스 제공업체)의 DNS서버에서 IP주소를 찾기 시작한다.
하지만 모든 URL의 IP주소가 하나의 서버에 존재하는게 아니기에 여러 절차를 거쳐 사용자가 원하는 URL주소를 찾는 과정을 거친다.
ISP의 DNS에 질의
ISP에도 존재하지 않는다면,
다음은 루트 네임 서버에 질의한다.

그래도 없다면... TLD 네임 서버에 질의한다.
( 그 다음도 있는데 잘 모르겠음)

이렇게 꼬리에 꼬리를 물고 찾아가 사용자가 원하는 URL에 대항하는 IP주소를 찾았다면 반환해주고, IP를 로컬단에 캐싱이 이루어진다.

아무튼! 이렇게 우리는 IP주소를 찾게되었고, 드디어 접속할 수 있다!!

3. TCP 연결
   이제는 반환된 IP주소로 사용자가 접속할 차례다.
   하지만 구글 IP주소로 들어간다고 서버에서 ‘고객님 이랏샤이마세~~!!‘ 라며 HTML, CSS, JS에 대한 파일을 바로 넘기지 않는다.
   애초에, TCP연결이 되어있지 않다면 구글 서버와 통신의 길이 열리지 않는다고 보는게 맞겠다.

다시 정리하면, 간단하게 구글 서버와 내 클라이언트를 연결하여 서버와 통신하기 위해선 길이 필요하다. 그 길을 만들어주는게 ‘TCP 연결설정‘이라고 보면 좋을거 같다.

TCP에 대해서 디테일 한스푼! (Three-Way Handsakes)
클라이언트가 접속하려는 서버에 SYN 패킷을 보낸다.
(이때 ISN을 같이 포함해 보낸다.)

서버에서 클라이언트에 다시 SYN-ACK 패킷을 보낸다.
(이때에도 ISN이 포함되어있고, 서버는 클라이언트에 확인응답도 포함되어있다.)

클라이언트는 다시 서버에 ACK 패킷을 보낸다.

이 세 과정은 클라이언트와 서버가 서로간데 ISN(시퀸스 번호)을 확인하고 연결을 설정하는 과정이다. 이 과정을 통하여 서버와 클라이언트는 신뢰성있는 연결을 할 수 있게된다.

ISN은 TCP연결을 사용할 때 처음으로 사용하는 시퀸스번호를 말한다.
시퀸스 번호: 데이터패킷의 순서와 무결성을 보장하기 위해서 사용한다. 4. 드디어 서버에 요청하기!
이제 TCP연결도 되었기때문에 서버와 통신을 할 수 있게 되었다!!

이제 웹페이지 렌더링에 필요한 HTML, CSS, JS에 대한 파일을 구글 서버에 요청을 보낸다.

그리고 구글 서버에서는 응답대로 해당 파일들을 넘겨줄 것이고, 브라우저는 서버로부터 받아온 파일들을 해석하여 렌더링 할 것이다.
(브라우저가 렌더링하는 과정에 대해서는 너무 길기때문에 여기까지...)

5. 연결 해제
   파일도 서버로부터 잘 넘겨받았고 이제 끝이라 생각했지만? 그럴수는 없다. 항상 마무리는 깔끔해야 하는법. 연결을 다시 해제해야한다.

데이터 전송이 완료되는 동시에, 클라이언트와 서버는 TCP연결을 해제하기 시작한다. 이때 ‘Four-Way Handshake'의 과정을 거치게 된다.

연결 해제에 대한 디테일 한스푼
먼저 클라이언트측에서 연결을 종료하기 위해서 FIN패킷을 서버로 전송한다.

서버에서는 받은 FIN패킷을 확인하고 ACK패킷을 클라이언트로 전송한다.

서버도 연결을 종료하기 위해 클라이언트에게 FIN패킷을 전송한다.

클라이언트 또한 서버에서 받은 FIN패킷을 확인 후, ACK패킷을 서버에 전송한다.

이 4가지 과정을 모두 완료하게 되면 비로서 모든 과정이 끝나게된다.

글 작성 후기
막상 제목과 같은 질문을 들었을때 머릿속에 정리가 안됫다.
먼저 DNS서버에 대한건 일부분만 알았을 뿐, 클라이언트단에서 시작해서 캐싱이 일어나는 부분에 대해서는 처음 알게되었다.
무엇보다 TCP에 대한 개념을 이번에 처음 알게되어서 아직 많이 부족하다고 생각하게 되는 계기가 되었다.

이번 글은 내가 수박겉핥기로 공부한 내용을 정리하기 위해서 작성하였다.

앞으로 꾸준히 더 CS에 대해 더 공부해야겠다.
