---
layout: post
title: 로그인관련 시도 글(세션 스토리지와 쿠키 장단점)
tag: Login, Session Storage, Cookie, Local Storage, project
---

# 로그인관련 시도 글(세션 스토리지와 쿠키 장단점)

## 1. 개요

‘로스트아크 숙제체크’ 웹사이트를 만들었다. 여러 기능이 들어갔지만, 그 중 가장 고민했던 부분은 로그인을 어떻게 구현하는가에 대한 문제였다. 이번에 내가 고민했던 방법과 시행착오, 또 현업에서는 어떤방식으로 이러한 문제들을 풀어가는지에 대한 글을 써보려고한다.

## 2. 문제점과 해결방법에 대한 고민

‘로스트아크 숙제체크’ 웹사이트는 Supabase를 사용하여 만들어졌다. Supabase에서는 Authentication기능도 제공하기에 해당 기능을 사용하여 개발을 진행하기로 하였다.

먼저 로그인 기능을 구현하면서 코드를 어떻게 구현할까에 대한 생각을 하였다.

1. 사용자가 회원가입을 하면 user라는 테이블에 사용자의 uuid와 함께 사용자가 회원가입시 입력했던 정보를 토대로 테이블열이 생성된다.
2. 회원가입을 완료한 사용자가 로그인에 성공하면 Supabase에서 반환되는 Access_token을 저장하고, Refresh_token을 사용하여 사용자를 체크한다.

이정도가 먼저 생각해본 로그인에 관련한 코드 구성이었다. 문제는 Access_token을 어디에 저장하는지에 관한 문제였다.

### 🤔 토큰을 어디에 저장할까?

클라이언트에서 저장공간은 3가지로 나눌 수 있다.

1. 로컬 스토리지 (Local Storage)
2. 세션 스토리지 (Session Storage)
3. 쿠키 (Cookie)

### 로컬 스토리지

부트캠프에서 프로젝트를 진행할때 아무런 생각없이 로컬 스토리지에 사용자에 대한 데이터를 담아서 무지성으로 사용했던 경험이 있다. 프로젝트 이후 아무리 생각해도 로컬에 넣으면 계속해서 사용자에 대한 정보가 남기에 보안에 취약하고 좋지않다는 생각을 가지고있었다.

- **장점**: 사용이 간편하고, 클라이언트 측에서 쉽게 접근 가능.
- **단점**: XSS 공격에 취약하여 보안에 취약할 수 있음.

### 세션 스토리지

이번 ‘로스트아크 숙제체크’ 웹페이지에 대한 프로젝트를 진행하면서 처음으로 세션 스토리지를 적용해보자는 생각이었다. 먼저 세션 스토리지의 장점으로 로컬 스토리지와 다르게 해당 브라우저의 창을 닫으면 세션 데이터가 자동으로 삭제되기에 로컬 스토리지보다 보안상으로 비교적 안전하다고 생각했다.

- **장점**: 브라우저 탭이 닫히면 자동으로 데이터가 삭제됨.
- **단점**: 로컬 스토리지와 마찬가지로 XSS 공격에 취약.

사용후기 : 쿠키와 세션 스토리지 두개 중 고민하면서 결과적으로 세션스토리지를 사용하게 되었다.
사용방법 자체는 로컬 스토리지와 별반 다를거없이 `sessionStorage.setItem`을 사용하여 세션 스토리지에 값을 저장하고 가져와 사용하면 되는 방법이었다.

### 쿠키

쿠키를 사용하는 것은 이번이 처음이었다. `react-cookie` 라이브러리를 사용하여 쿠키를 쉽게 관리할 수 있었다. 라이브러리를 이용해 쿠키를 설정하고 값을 저장하는 데는 큰 문제가 없었다.

하지만 이번에 쿠키 대신 세션 스토리지를 사용하기로 결정한 이유가 있다.

→ 보통 로그인 시스템을 구현할 때 쿠키를 많이 사용한다. 쿠키에 저장된 토큰 값을 HTTP 요청의 헤더에 포함시켜 인증을 수행하는 방식이 일반적이다. 그러나 로그인 시스템은 프론트엔드와 백엔드 모두에서 처리되어야 하는 복합적인 문제이다. 프론트엔드만 개발하는 입장에서 쿠키를 사용해 로그인을 관리할지, 세션 스토리지를 사용할지 고민이 많았다. 백엔드가 없는 상황에서는 어느 쪽을 사용하더라도 완전한 인증 시스템을 구현하기는 어렵다는 느낌을 받았다.

쿠키와 세션 스토리지의 차이점은 다음과 같다:

- **쿠키**:
  - 서버와 클라이언트 간의 HTTP 요청 및 응답에서 자동으로 전송된다.
  - 보안 설정을 통해 HttpOnly, Secure 등의 속성을 설정할 수 있다.
  - 만료 시간을 설정하여 영구적 또는 일시적으로 저장할 수 있다.
- **세션 스토리지**:
  - 브라우저 세션이 종료되면 데이터가 사라진다.
  - 서버와 자동으로 전송되지 않으며, 클라이언트 측에서만 접근 가능하다.
  - 사용이 간편하며, 보안이 상대적으로 높은 정보를 저장하기에는 적합하지 않다.
  -

이번에 세션 스토리지를 사용한 이유는 이번 토이 프로젝트가 로그인을 요구하지만, 실제로는 사용자를 구분하는 간단한 시스템이 필요했기 때문이다. 또한 사용자가 주로 주변 친구들이라는 점을 고려하여, 세션 스토리지를 사용하는 것이 적절하다고 판단했다.

## 추가적으로 알게 된 점

사실 쿠키도 그냥 설정하고 값을 저장하고 클라이언트단에서 가져다 쓰면 되는줄 알았다. 근데 시니어개발자분과 로그인에 관해서 이야기를 나누다보니 서버에서 클라이언트측에서 접근하지 못하게 막는다고 한다.

**HttpOnly**: 클라이언트 측 JavaScript에서 쿠키에 접근하지 못하도록 설정.

그 이유는 보안이슈 때문이다.

1. XSS
   - 클라이언트 브라우저에 JavaScript 를 삽입해 실행하는 공격
     - 공격자의 코드가 내 사이트의 로직인 척 행동할 수 있다.
2. CSRF
   - 다른 사이트에서 우리 사이트의 api 콜을 요청해 실행하는 공격
     - 로그인한 척 계좌 비밀번호를 바꾸거가 송금을 보낸다.

또한 **Secure** 속성이 있는데, 이 속성도 보안을 위해서 중요한 속성이라고 한다.

**Secure**: 쿠키를 HTTPS를 통해서만 전송.

## 현재 구현한 로직

```js
export const signinUser = async (email: string, password: string) => {
  try {
    const { data, error } = await supabase.auth.signInWithPassword({
      email,
      password,
    });

    if (error) {
      console.error("로그인 오류 :", error);
      return { success: false, error };
    } else {
      sessionStorage.setItem("userToken", data.session.refresh_token);
      useAuthStore.getState().setUserToken(data.session.access_token);
    }

    return { success: true, data };
  } catch (error) {
    console.error("로그인 중 예상치 못한 오류가 발생하였습니다.", error);
    return { success: false, error };
  }
};
```

Supabase에서 로그인을 하고 받아온 JWT에서 access_token은 전역상태로 저장하여 클라이언트단에서 보이지않게 한다.

그리고 refresh_token을 세션 스토리지에 저장하고, 사용자가 요청을 할 경우 access_token과 refresh_token을 가져와 적절히 사용한다.

## 마치며

로그인에 대한 로직이해가 아직까지도 많이 부족하다고 생각한다. 개발자가 되기 위해서는 꼭 필요한 지식이라 생각된다. 이번을 기회로 공부하기로 다짐했다.

이후 로그인을 어떻게 처리해야 하는지에 대해서 다뤄보도록 하겠다.
